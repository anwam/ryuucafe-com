---
import { type Product } from "../types";
import ProductItem from "../components/ProductItem.astro";
import Layout from "@/components/Layout.astro";

const response = await fetch("https://graphql.datocms.com/", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${import.meta.env.DATOCMS_API_KEY}`,
  },
  body: JSON.stringify({
    query: `
      query AllProducts {
        allProducts(orderBy: shelfOrder_ASC) {
          available
          description
          id
          name
          onSale
          onlyDelivery
          price
          salePrice
          bestSeller
          shelfOrder
          tasteNote
          powderType
          recommended
          coverImage {
            blurhash
            thumbhash
            responsiveImage(imgixParams: { auto: compress, fm: webp, q: 100, minW: 300, w: 640 }) {
                src
                srcSet
                sizes
                width
                height
            }
          }
        }
      }`,
  }),
});

const json = (await response.json()) as { data: { allProducts: Product[] } };
const products = json.data.allProducts;
const singleMenus = products.filter((product) => product.powderType);
const blendMenus = products.filter((product) => !product.powderType);
---

<Layout>
  <article
    class="container relative mx-auto flex max-w-screen-lg flex-col gap-y-4 p-4"
  >
    <h2 class="w-full text-center text-xl font-bold text-primary md:w-fit">
      มัทฉะเกรดพิธีการ
    </h2>
    <p>
      ริว ใช้ผงมัทฉะระดับ Ceremonial Grade หรือเกรดพิธีการในการชงทุกเมนู
      ด้วยคุณภาพและรสชาติที่สามารถสร้างความซับซ้อน มีความอูมามิและมีกลิ่นหอม
      ช่วยให้ประสบการณ์การดื่มชาเพิ่มไปอีกขั้น
    </p>
    <h2 id="menu" class="text-xl font-bold text-primary">เมนู</h2>
    <h3 class="mt-2 text-3xl text-primary underline">Single สายพันธุ์เดี่ยว</h3>
    <ul class="grid grid-flow-row grid-cols-6 gap-4">
      {
        singleMenus.map((product) => (
          <li class="col-span-3 flex flex-row md:col-span-2">
            <ProductItem product={product} />
          </li>
        ))
      }
    </ul>
    <h3 class="mt-2 text-3xl text-primary underline">
      Blend มัทฉะเบลนด์สูตรเฉพาะของทางร้าน
    </h3>
    <ul class="grid grid-flow-row grid-cols-6 gap-4">
      {
        blendMenus.map((product) => (
          <li class="col-span-3 flex flex-row md:col-span-2">
            <ProductItem product={product} />
          </li>
        ))
      }
    </ul>
  </article>
</Layout>
