---
import { Image, Picture } from "astro:assets";
import { type Product } from "../types";
import Header from "../components/Header.astro";
import ProductItem from "../components/ProductItem.astro";
import Footer from "@/components/Footer.astro";

const response = await fetch("https://graphql.datocms.com/", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${import.meta.env.DATOCMS_API_KEY}`,
  },
  body: JSON.stringify({
    query: `
      query AllProducts {
        allProducts(orderBy: _createdAt_ASC) {
          available
          description
          id
          name
          onSale
          onlyDelivery
          price
          salePrice
          coverImage {
            blurhash
            thumbhash
            responsiveImage(imgixParams: { auto: compress, fm: webp, q: 100, minW: 300, w: 640 }) {
                src
                srcSet
                sizes
                width
                height
            }
          }
        }
      }`,
  }),
});

const json = (await response.json()) as { data: { allProducts: Product[] } };
const products = json.data.allProducts;
---

<html lang="th" data-theme="corporate">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>RYUU</title>
  </head>
  <body class="bg-base-100">
    <Header />
    <section
      class="container flex flex-col gap-y-4 mx-auto max-w-screen-lg p-4"
    >
      <p
        class="self-center text-xl font-bold"
        style={{ textShadow: "1px 1px 1px #999" }}
      >
        Menu
      </p>
      <ul class="grid grid-cols-3 grid-flow-row gap-4">
        {
          products.map((product, index) => (
            <li class="col-span-3 flex flex-row md:col-span-1">
              <ProductItem product={product} isTopSeller={index === 0} />
            </li>
          ))
        }
      </ul>
    </section>
    <Footer />
  </body>
</html>
